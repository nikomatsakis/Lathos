package com.smallcultfollowing.lathos.server;

import java.io.IOException;
import java.io.Writer;
import java.util.Collections;
import java.util.List;

import org.apache.commons.lang.StringEscapeUtils;

import com.smallcultfollowing.lathos.model.Output;
import com.smallcultfollowing.lathos.model.Page;

public class HtmlOutput implements Output {
	public final WebServer server;
	public final List<Page> topPages;
	public final Writer writer;

	public HtmlOutput(List<Page> topPages, Writer writer) {
		super();
		this.topPages = Collections.unmodifiableList(topPages);
		this.writer = writer;
	}

	@Override
	public List<Page> topPages() {
		return topPages;
	}

	@Override
	public void outputObject(Object content) {
	}

	@Override
	public void outputText(String content) {
		try {
			StringEscapeUtils.escapeHtml(writer, content);
		} catch (IOException e) {
			e.printStackTrace(System.err);
		}
	}

	@Override
	public void startLink(Page target) {
		try {
			writer.write("<a href='");
			writer.write(server.url(target));
			writer.write("'>");
		} catch (IOException e) {
			e.printStackTrace(System.err);
		}
	}

	@Override
	public void endLink(Page target) {
		try {
			writer.write("</a>");
		} catch (IOException e) {
			e.printStackTrace(System.err);			
		}
	}

}
